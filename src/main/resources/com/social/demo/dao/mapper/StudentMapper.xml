<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.social.demo.dao.mapper.StudentMapper">
    <update id="deleteGrades">
        UPDATE student SET grade = null, score = null WHERE user_id IN (SELECT user_id FROM user WHERE user_number = #{userNumber})
    </update>

    <select id="selectClassIdByUserNumber" resultType="java.lang.Long">
        SELECT class_id FROM student WHERE user_id IN (SELECT user_id FROM user WHERE user_number = #{number})
    </select>
    <select id="selectClassIdByUserId" resultType="java.lang.Long">
        SELECT class_id FROM student WHERE user_id = #{userId}
    </select>
    <select id="getUserIdByClassId" resultType="java.lang.Long">
        SELECT user_id FROM student WHERE class_id = #{classId}
    </select>
    <select id="getGrades" resultType="com.social.demo.data.bo.GradeBo">
        SELECT s.score, u.username, u.user_number, s.grade FROM user AS u, student AS s WHERE
        u.user_id = s.user_id AND enrollment_year = #{year}
        <if test="keyword != null and keyword != 'null' and keyword != ''">
           AND (u.user_number LIKE CONCAT("%",#{keyword},"%") OR u.username LIKE CONCAT("%",#{keyword},"%"))
        </if>
        LIMIT #{number1}, #{number2}
    </select>
    <select id="getGradesCount" resultType="java.lang.Integer">
        SELECT COUNT(u.user_id) FROM user AS u, student AS s WHERE
        u.user_id = s.user_id AND enrollment_year = #{year}
        <if test="keyword != null and keyword != 'null' and keyword != ''">
            AND (u.user_number LIKE CONCAT("%",#{keyword},"%") OR u.username LIKE CONCAT("%",#{keyword},"%"))
        </if>
    </select>
    <select id="getAllGrades" resultType="com.social.demo.data.bo.GradeBo">
        SELECT s.score, u.username, u.user_number, s.grade FROM user AS u, student AS s WHERE
            u.user_id = s.user_id AND enrollment_year = #{year}
    </select>
</mapper>
